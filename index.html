<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER PRO | è‡ªå®šç¾©å›æ¸¬ç³»çµ± V6</title>
    <style>
        body { background: #000; color: #eee; font-family: 'Segoe UI', sans-serif; padding: 20px; font-size: 13px; }
        .control-panel { background: #1c1c1c; padding: 15px; border-radius: 8px; border: 1px solid #333; margin-bottom: 20px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        input[type="date"] { background: #333; color: #fff; border: 1px solid #555; padding: 5px; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #333; padding: 10px; text-align: center; }
        th { background: #252525; color: #f2a900; position: sticky; top: 0; z-index: 10; }
        .btn-run { background: #f2a900; color: #000; padding: 10px 25px; cursor: pointer; border: none; font-weight: bold; border-radius: 4px; transition: 0.3s; }
        .btn-run:hover { background: #ffcc00; }
        .score-box { background: #444; color: #fff; padding: 3px 8px; border-radius: 3px; font-weight: bold; }
        .score-vip { background: linear-gradient(45deg, #f2a900, #ffcc00) !important; color: #000 !important; box-shadow: 0 0 10px #f2a900; border: 1px solid #fff; }
        .row-vip { background-color: rgba(242, 169, 0, 0.15) !important; }
        .row-win { background-color: rgba(6, 78, 59, 0.4); }
        .row-loss { background-color: rgba(127, 29, 29, 0.4); }
        .up-text { color: #00ffcc; font-weight: bold; }
        .down-text { color: #ff6666; }
    </style>
</head>
<body>
    <h1>ğŸ¯ HUNTER é‡åŒ–å›æ¸¬ V6 (è‡ªå®šç¾©å€é–“)</h1>
    
    <div class="control-panel">
        <div>é–‹å§‹æ—¥æœŸï¼š<input type="date" id="startDate"></div>
        <div>çµæŸæ—¥æœŸï¼š<input type="date" id="endDate"></div>
        <button class="btn-run" onclick="startBacktest()">ğŸš€ åŸ·è¡Œæ·±åº¦å›æ¸¬</button>
        <div id="status">è¨­å®šæ—¥æœŸå¾Œé»æ“ŠæŒ‰éˆ•</div>
    </div>
    
    <table id="bt-table">
        <thead>
            <tr>
                <th>æ—¥æœŸ</th>
                <th>å¹£ç¨®</th>
                <th>08:00 è©•åˆ†</th>
                <th style="color:#00ffcc">æœŸé–“æœ€é«˜ %</th>
                <th style="color:#ff6666">æœŸé–“æœ€ä½ %</th>
                <th>20:00 æ”¶ç›¤ %</th>
            </tr>
        </thead>
        <tbody id="bt-body"></tbody>
    </table>

<script>
    // é è¨­æ—¥æœŸç‚ºéå» 7 å¤©
    const today = new Date();
    const lastWeek = new Date();
    lastWeek.setDate(today.getDate() - 7);
    document.getElementById('endDate').value = today.toISOString().split('T')[0];
    document.getElementById('startDate').value = lastWeek.toISOString().split('T')[0];

    async function startBacktest() {
        const startInput = document.getElementById('startDate').value;
        const endInput = document.getElementById('endDate').value;
        const status = document.getElementById('status');
        const body = document.getElementById('bt-body');
        
        if(!startInput || !endInput) return alert("è«‹é¸æ“‡å®Œæ•´æ—¥æœŸ");

        body.innerHTML = '';
        const startDate = new Date(startInput);
        const endDate = new Date(endInput);
        const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));

        if(daysDiff < 0) return alert("é–‹å§‹æ—¥æœŸä¸èƒ½æ™šæ–¼çµæŸæ—¥æœŸ");
        if(daysDiff > 30) return alert("ç‚ºé¿å…è¢«å°é– IPï¼Œå–®æ¬¡æŸ¥è©¢è«‹å‹¿è¶…é 30 å¤©");

        status.innerText = "æ­£åœ¨å–å¾—ç†±é–€å¹£ç¨®...";
        const tRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
        const tData = await tRes.json();
        const topSymbols = tData.filter(d => d.symbol.endsWith('USDT')).sort((a, b) => b.quoteVolume - a.quoteVolume).slice(0, 45).map(d => d.symbol);

        for (let i = 0; i <= daysDiff; i++) {
            let d = new Date(startDate);
            d.setDate(d.getDate() + i);
            let dateStr = d.toLocaleDateString();
            status.innerText = `æ­£åœ¨åˆ†æ ${dateStr} (${i+1}/${daysDiff+1}å¤©)...`;
            
            for (let s of topSymbols) {
                try {
                    let startTs = new Date(d.setHours(8, 0, 0, 0)).getTime();
                    let res = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1h&startTime=${startTs}&limit=13`);
                    let k = await res.json();
                    
                    if (k.length >= 12) {
                        let open08 = parseFloat(k[0][1]), high08 = parseFloat(k[0][2]), low08 = parseFloat(k[0][3]), close20 = parseFloat(k[12][4]), vol08 = parseFloat(k[0][7]);
                        let range08 = ((high08 - low08) / low08) * 100;
                        let score = (vol08 > 8000000) ? Math.min(100, Math.round(range08 * 8 + 35)) : 0;
                        
                        if (score >= 45) {
                            let highArr = k.slice(0, 13).map(x => parseFloat(x[2])), lowArr = k.slice(0, 13).map(x => parseFloat(x[3]));
                            let maxH = Math.max(...highArr), minL = Math.min(...lowArr);
                            let maxDiff = ((maxH - open08) / open08 * 100).toFixed(2);
                            let minDiff = ((minL - open08) / open08 * 100).toFixed(2);
                            let finalDiff = ((close20 - open08) / open08 * 100).toFixed(2);

                            let isVip = score >= 80;
                            let rowClass = isVip ? 'row-vip' : (finalDiff >= 0 ? 'row-win' : 'row-loss');
                            let scoreClass = isVip ? 'score-box score-vip' : 'score-box';

                            body.insertAdjacentHTML('beforeend', `
                                <tr class="${rowClass}">
                                    <td>${dateStr}</td>
                                    <td>${s.replace('USDT','')}</td>
                                    <td><span class="${scoreClass}">${score}</span></td>
                                    <td class="up-text">${maxDiff}%</td>
                                    <td class="down-text">${minDiff}%</td>
                                    <td style="font-weight:bold; color:${finalDiff >= 0 ? '#00ffcc' : '#ff6666'}">${finalDiff}%</td>
                                </tr>
                            `);
                        }
                    }
                } catch(e){}
            }
            await new Promise(r => setTimeout(r, 200));
        }
        status.innerText = "âœ… å›æ¸¬å®Œæˆï¼";
    }
</script>
</body>
</html>
